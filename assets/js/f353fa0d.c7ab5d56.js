"use strict";(self.webpackChunkmongoose_relay_paginate=self.webpackChunkmongoose_relay_paginate||[]).push([[517],{3905:function(e,t,n){n.d(t,{Zo:function(){return u},kt:function(){return d}});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),c=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=c(e.components);return a.createElement(s.Provider,{value:t},e.children)},g={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},p=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),p=c(n),d=r,m=p["".concat(s,".").concat(d)]||p[d]||g[d]||o;return n?a.createElement(m,i(i({ref:t},u),{},{components:n})):a.createElement(m,i({ref:t},u))}));function d(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=p;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,i[1]=l;for(var c=2;c<o;c++)i[c]=n[c];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}p.displayName="MDXCreateElement"},2746:function(e,t,n){n.r(t),n.d(t,{assets:function(){return u},contentTitle:function(){return s},default:function(){return d},frontMatter:function(){return l},metadata:function(){return c},toc:function(){return g}});var a=n(7462),r=n(3366),o=(n(7294),n(3905)),i=["components"],l={},s="aggregateRelayPaginate()",c={unversionedId:"API/aggregateRelayPaginate",id:"API/aggregateRelayPaginate",title:"aggregateRelayPaginate()",description:"released in v2.0.0",source:"@site/docs/API/aggregateRelayPaginate.md",sourceDirName:"API",slug:"/API/aggregateRelayPaginate",permalink:"/mongoose-relay-paginate/docs/API/aggregateRelayPaginate",editUrl:"https://github.com/johnsonjo4531/mongoose-relay-paginate/tree/main/packages/create-docusaurus/templates/shared/docs/API/aggregateRelayPaginate.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Intro",permalink:"/mongoose-relay-paginate/docs/intro"},next:{title:"relayPaginate()",permalink:"/mongoose-relay-paginate/docs/API/relayPaginate"}},u={},g=[{value:"released in v2.0.0",id:"released-in-v200",level:3}],p={toc:g};function d(e){var t=e.components,n=(0,r.Z)(e,i);return(0,o.kt)("wrapper",(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"aggregaterelaypaginate"},"aggregateRelayPaginate()"),(0,o.kt)("h3",{id:"released-in-v200"},"released in v2.0.0"),(0,o.kt)("p",null,"You'll need to import this package at the top of your entry file:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},'import "mongoose-relay-paginate";\n')),(0,o.kt)("p",null,"Then you can use ",(0,o.kt)("inlineCode",{parentName:"p"},".aggregateRelayPaginate()")," off of any mongoose Model."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},'const result = await UserModel.aggregateRelayPaginate(\n  [{ $sort: { _id: -1 } }],\n  {\n    cusorKeys: ["_id"],\n    last: 1,\n    before: result.pageInfo.endCursor,\n  }\n);\n')),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"aggregateRelayPaginate")," takes in two arguments the first is its mongoose aggregation pipeline argument and the second is its relayPaginate options argument."),(0,o.kt)("p",null,"The main necessary part of relayPaginate option is the cursorKeys option you pass in. ",(0,o.kt)("inlineCode",{parentName:"p"},"cursorKeys")," is a chooses which keys are used in the cursor. The cursor defines a way that the specific item in a collection should be found. Say for example you have three user's with names: Bill, Jill, and Phill, which could be created like so."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},'const doc = new UserModel({\n  name: "Bill",\n  email: "bill@example.com",\n  avatar: "https://i.imgur.com/dM7Thhn.png",\n});\n\nconst doc2 = new UserModel({\n  name: "Jill",\n  email: "jill@example.com",\n  avatar: "https://i.imgur.com/dM7Thhn.png",\n});\n\nconst doc3 = new UserModel({\n  name: "Phill",\n  email: "Phill@example.com",\n  avatar: "https://i.imgur.com/dM7Thhn.png",\n});\nawait doc.save();\nawait doc2.save();\nawait doc3.save();\n')),(0,o.kt)("p",null,"The cursorKeys below will select the name as the cursor. This means the before and after options, if provided, also have to fit this shape in order to return the proper output."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},'const result = await UserModel.aggregateRelayPaginate(\n    [\n      { $sort: { name: 1 } }\n    ],\n    {\n      // we allow the cursor to be the user\'s name\n      cursorKeys: ["name"],\n      // we get the first 2 items only\n      first: 2,\n      // We start getting results only after we have found bill\'s record\n      after: {\n        name: "Bill"\n      }\n    });\nconsole.log(result.nodes); // Will be an array of Jill and then Phill\'s object\n')),(0,o.kt)("p",null,"Generally you would want the cursor (represented by the values of the ",(0,o.kt)("inlineCode",{parentName:"p"},"cursorKeys")," array, and the before and after options) to match whatever you are sorting by; a good default if you don't know what you are sorting by is to use the _id field as your cursor as it is the default sort field in mongodb, though this default is unnecessary in newer versions of the library."))}d.isMDXComponent=!0}}]);